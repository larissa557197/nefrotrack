<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="pt-BR">
<head th:replace="fragments/layout :: head(~{::title})">
    <title th:text="#{pacientes.title}">Pacientes</title>
</head>

<body th:replace="fragments/layout :: body(~{::title}, ~{::content})">

<div th:fragment="content">

    <!-- Header + ações -->
    <div class="d-flex flex-wrap gap-2 justify-content-between align-items-center mb-3">
        <div class="d-flex align-items-center gap-3">
            <h2 class="mb-0" th:text="#{pacientes.title}">Pacientes</h2>
            <span class="badge bg-primary-subtle text-primary border border-primary-subtle"
                  th:text="${#lists.size(pacientes)} + ' ' + #{itens.encontrados}">
        0 encontrados
      </span>
        </div>

        <div class="d-flex flex-wrap gap-2">
            <!-- Busca (GET ?q=) -->
            <form class="d-flex" method="get" th:action="@{/pacientes}">
                <input class="form-control" name="q" th:value="${param.q}"
                       th:placeholder="#{buscar.por.nome.email} ?: 'Buscar por nome ou e-mail'">
                <button class="btn btn-outline-primary ms-2" type="submit">
                    <i class="bi bi-search"></i>
                    <span class="d-none d-sm-inline" th:text="#{btn.buscar}">Buscar</span>
                </button>
            </form>

            <a class="btn btn-primary" th:href="@{/pacientes/novo}">
                <i class="bi bi-person-plus"></i>
                <span class="ms-1" th:text="#{paciente.new}">Novo Paciente</span>
            </a>
        </div>
    </div>

    <!-- Tabela -->
    <div class="card shadow-sm">
        <div class="table-responsive">
            <table class="table align-middle mb-0">
                <thead class="table-light">
                <tr>
                    <th class="text-nowrap">#</th>
                    <th class="text-nowrap" th:text="#{paciente.nome}">Nome</th>
                    <th class="text-nowrap" th:text="#{paciente.email}">E-mail</th>
                    <th class="text-nowrap" th:text="#{paciente.dataNascimento}">Data de Nascimento</th>
                    <th class="text-nowrap" th:text="#{paciente.telefone}">Telefone</th>
                    <th class="text-end text-nowrap" th:text="#{table.acoes}">Ações</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="p : ${pacientes}">
                    <td class="text-muted" th:text="${p.id}">1</td>
                    <td>
                        <div class="fw-semibold" th:text="${p.nome}">Nome</div>
                    </td>
                    <td>
                        <a th:href="'mailto:' + ${p.email}" th:text="${p.email}">email@exemplo.com</a>
                    </td>
                    <td th:text="${p.dataNascimento != null ? #temporals.format(p.dataNascimento, 'dd/MM/yyyy') : '-'}">01/01/2000</td>
                    <td th:text="${p.telefone}">(11) 99999-9999</td>
                    <td class="text-end">
                        <div class="btn-group btn-group-sm">
                            <a class="btn btn-outline-secondary"
                               th:href="@{'/pacientes/' + ${p.id} + '/editar'}">
                                <i class="bi bi-pencil-square"></i>
                                <span class="d-none d-md-inline" th:text="#{btn.edit}">Editar</span>
                            </a>

                            <form class="d-inline"
                                  th:action="@{'/pacientes/' + ${p.id} + '/excluir'}"
                                  method="post"
                                  onsubmit="return confirm('Excluir este paciente?');">
                                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                                <button class="btn btn-outline-danger" type="submit">
                                    <i class="bi bi-trash"></i>
                                    <span class="d-none d-md-inline" th:text="#{btn.delete}">Excluir</span>
                                </button>
                            </form>
                        </div>
                    </td>
                </tr>

                <!-- Estado vazio -->
                <tr th:if="${#lists.isEmpty(pacientes)}">
                    <td colspan="6" class="text-center py-5">
                        <i class="bi bi-inbox fs-1 text-secondary d-block mb-2"></i>
                        <div class="text-muted mb-3" th:text="#{lista.vazia.pacientes} ?: 'Nenhum paciente cadastrado.'">
                            Nenhum paciente cadastrado.
                        </div>
                        <a class="btn btn-primary" th:href="@{/pacientes/novo}">
                            <i class="bi bi-person-plus"></i>
                            <span class="ms-1" th:text="#{paciente.new}">Novo Paciente</span>
                        </a>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="mt-3">
        <a class="btn btn-secondary" th:href="@{/}">
            <i class="bi bi-arrow-left"></i>
            <span class="ms-1" th:text="#{btn.back}">Voltar</span>
        </a>
    </div>

</div>
</body>
</html>
