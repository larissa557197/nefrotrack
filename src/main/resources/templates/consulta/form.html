<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title th:text="${consulta != null and consulta.id != null} ? 'Editar Consulta' : 'Nova Consulta'">Consulta</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container mt-4">

<h1 class="h3" th:text="${consulta != null and consulta.id != null} ? 'Editar Consulta' : 'Nova Consulta'">Consulta</h1>

<div th:object="${consulta}">
    <div th:if="${#fields.hasAnyErrors()}" class="alert alert-danger">Corrija os erros abaixo.</div>

    <!-- ===== FORM CRIAÇÃO ===== -->
    <form th:if="${consulta.id} == null"
          method="post"
          th:object="${consulta}"
          th:action="@{/consultas}">

        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

        <div class="mb-3">
            <label class="form-label">Paciente</label>
            <select class="form-select" th:field="*{paciente.id}">
                <option value="">Selecione…</option>
                <option th:each="p : ${pacientes}" th:value="${p.id}" th:text="${p.nome}"></option>
            </select>
            <div class="text-danger" th:errors="*{paciente.id}"></div>
        </div>

        <div class="mb-3">
            <label class="form-label">Data/Hora</label>
            <input class="form-control" type="datetime-local" th:field="*{dataHora}"/>
            <div class="text-danger" th:errors="*{dataHora}"></div>
        </div>

        <div class="mb-3">
            <label class="form-label">Médico</label>
            <input class="form-control" type="text" th:field="*{medicoNome}"/>
            <div class="text-danger" th:errors="*{medicoNome}"></div>
        </div>

        <div class="mb-3">
            <label class="form-label">Anotações</label>
            <textarea class="form-control" th:field="*{anotacoes}" rows="3"></textarea>
        </div>

        <div class="d-flex gap-2">
            <button class="btn btn-primary" type="submit">Salvar</button>
            <a class="btn btn-secondary" th:href="@{/consultas}">Cancelar</a>
        </div>
    </form>

    <!-- ===== FORM EDIÇÃO ===== -->
    <form th:if="${consulta.id} != null"
          method="post"
          th:object="${consulta}"
          th:action="@{/consultas/{id}(id=*{id})}">

        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

        <div class="mb-3">
            <label class="form-label">Paciente</label>
            <select class="form-select" th:field="*{paciente.id}">
                <option value="">Selecione…</option>
                <option th:each="p : ${pacientes}" th:value="${p.id}" th:text="${p.nome}"></option>
            </select>
            <div class="text-danger" th:errors="*{paciente.id}"></div>
        </div>

        <div class="mb-3">
            <label class="form-label">Data/Hora</label>
            <input class="form-control" type="datetime-local" th:field="*{dataHora}"/>
            <div class="text-danger" th:errors="*{dataHora}"></div>
        </div>

        <div class="mb-3">
            <label class="form-label">Médico</label>
            <input class="form-control" type="text" th:field="*{medicoNome}"/>
            <div class="text-danger" th:errors="*{medicoNome}"></div>
        </div>

        <div class="mb-3">
            <label class="form-label">Anotações</label>
            <textarea class="form-control" th:field="*{anotacoes}" rows="3"></textarea>
        </div>

        <div class="d-flex gap-2">
            <button class="btn btn-primary" type="submit">Salvar</button>
            <a class="btn btn-secondary" th:href="@{/consultas}">Cancelar</a>
        </div>
    </form>
</div>

</body>
</html>
